<div class="login-wrapper">
  <mat-card class="login-card mat-elevation-z8">
    <mat-card-header class="login-header">
      <div mat-card-avatar class="brand-avatar">
        <mat-icon>lock</mat-icon>
      </div>
      <mat-card-title>Inicia sesión</mat-card-title>
      <mat-card-subtitle>Accede a la plataforma</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="login-form" autocomplete="on">
        <!-- Usuario -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Usuario</mat-label>
          <input
            matInput
            formControlName="username"
            placeholder="admin"
            autocomplete="username"
            required
          />
          <mat-icon matSuffix>person</mat-icon>
          <mat-error *ngIf="form.get('username')?.hasError('required')">
            El usuario es obligatorio
          </mat-error>
        </mat-form-field>

        <!-- Contraseña -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Contraseña</mat-label>
          <input
            matInput
            [type]="hide ? 'password' : 'text'"
            formControlName="password"
            placeholder="•••••••"
            autocomplete="current-password"
            required
          />
          <button
            mat-icon-button
            matSuffix
            type="button"
            (click)="hide = !hide"
            [attr.aria-label]="hide ? 'Mostrar contraseña' : 'Ocultar contraseña'"
            [attr.aria-pressed]="!hide"
          >
            <mat-icon>{{ hide ? 'visibility' : 'visibility_off' }}</mat-icon>
          </button>
          <mat-error *ngIf="form.get('password')?.hasError('required')">
            La contraseña es obligatoria
          </mat-error>
          <mat-error *ngIf="form.get('password')?.hasError('minlength')">
            Mínimo 4 caracteres
          </mat-error>
        </mat-form-field>

        <!-- Error de login -->
        <mat-card *ngIf="error" class="error-box mat-elevation-z1">
          <mat-card-content class="error-text">
            <mat-icon>error_outline</mat-icon>
            <span>{{ error }}</span>
          </mat-card-content>
        </mat-card>

        <!-- Enviar -->
        <button
          mat-raised-button
          color="primary"
          class="full-width btn-login"
          type="submit"
          [disabled]="form.invalid || loading"
        >
          <ng-container *ngIf="!loading; else cargando">Ingresar</ng-container>
          <ng-template #cargando>
            <mat-progress-spinner mode="indeterminate" diameter="20"></mat-progress-spinner>
          </ng-template>
        </button>
      </form>
    </mat-card-content>
  </mat-card>
</div>
